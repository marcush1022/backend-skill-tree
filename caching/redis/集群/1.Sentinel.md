# **Sentinel**

- 我们可以将 ```Redis Sentinel``` 集群看成是一个 ```ZooKeeper``` 集群，它是集群高可用的心脏，它一般是由 3~5 个节点组成，这样挂了个别节点集群还可以正常运转。

- **它负责持续监控主从节点的健康，当主节点挂掉时，```自动选择一个最优的从节点```切换为主节点**。

- **客户端来连接集群时，会首先连接 sentinel**，通过 sentinel 来查询主节点的地址，然后再去连接主节点进行数据交互。

- **当主节点发生故障时，客户端会重新向 sentinel 要地址，sentinel 会将最新的主节点地址告诉客户端**。如此应用程序将无需重启即可**自动完成节点切换**。

<br>

## **消息丢失**
- **Redis 主从采用```异步复制```**，意味着当主节点挂掉时，从节点可能没有收到全部的同步消息，这部分未同步的消息就丢失了。如果主从延迟特别大，那么丢失的数据就可能会特别多。

- **Sentinel 无法保证消息```完全不丢失```**，**但是也尽可能保证消息```少丢失```**。它有两个选项可以限制主从延迟过大。

    ```bash
    min-slaves-to-write 1 
    min-slaves-max-lag 10
    ```

- **第一个参数表示主节点必须至少有一个从节点在进行正常复制**，否则就停止对外写服务，丧失可用性。

- 何为正常复制，何为异常复制？这个就是由第二个参数控制的，它的单位是秒，**表示如果 10s 没有收到从节点的反馈，就意味着从节点同步不正常**，要么网络断开了，要么一直没有给反馈。